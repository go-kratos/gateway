# This is a gateway config.
name: "helloworld"
hosts:
  - "localhost"
  - "127.0.0.1"
middlewares:
  - name: "cors"
    options:
      "@type": "type.googleapis.com/gateway.middleware.cors.v1.Cors"
      allowedOrigins:
        - ".google.com"
  - name: "dyeing"
    options:
      "@type": "type.googleapis.com/gateway.middleware.dyeing.v1.Dyeing"
      header: "x-md-global-color"
      label: "color"
  - name: "otel"
    options:
      "@type": "type.googleapis.com/gateway.middleware.otel.v1.Otel"
      httpEndpoint: "localhost:4318" # defalut opentelemetry collector port
  - name: "logging"
    options:
      "@type": "type.googleapis.com/gateway.middleware.logging.v1.Logging"
      path: "./access_log.log"
  - name: "Prometheus"
    options:
      "@type": "type.googleapis.com/gateway.middleware.prometheus.v1.Prometheus"
      seconds:
        namespace: "gateway"
        subsystem: "requests"
        name: "duration_sec"
        help: "gateway requests duration(sec)."
        buckets:
          - "0.005"
          - "0.01"
          - "0.025"
          - "0.05"
          - "0.1"
          - "0.25"
          - "0.5"
          - "1"
        labelNames:
          - "kind"
          - "operation"
      requests:
        namespace: "gateway"
        subsystem: "requests"
        name: "code_total"
        help: "The total number of processed requests"
        labelNames:
          - "kind"
          - "operation"
          - "code"
          - "reason"
endpoints:
  - path: "/helloworld/*"
    method: "*"
    timeout: "1s"
    protocol: "HTTP"
    backends:
      - target: "127.0.0.1:8000"
  - path: "/helloworld.Greeter/*"
    method: "*"
    timeout: "1s"
    protocol: "GRPC"
    backends:
      - target: "127.0.0.1:9000"
